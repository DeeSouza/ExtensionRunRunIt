var urlAPI="https://secure.runrun.it/api/v1.0",urlTasks="/tasks",urlUsers="/users/",urlUserStat="/user_statistics/",username=window.localStorage.getItem("username"),menuApp=$("#menuApp"),getUser,config={auth:0};$(document).ready(function(){function e(e){return(e/3600).toFixed(2).replace(".",":")+"Hs"}function t(e){var t=["01","02","03","04","05","06","07","08","09","10","11","12"],a=e.getDate()<10?"0"+e.getDate():e.getDate(),s=e.getMonth(),i=e.getFullYear();return a+"/"+t[s]+"/"+i}function a(e){return{queued:"Na Fila",working_on:"Trabalhando"}[e]}function s(){var s=$("#list-tasks"),i=l.profile.id;$.ajax({type:"GET",url:urlAPI+urlTasks+"?responsible_id="+i,beforeSend:function(){s.html('<p align="center"><img src="img/ripple.gif" height="30"></p>')},success:function(i){s.html(""),$.each(i,function(i,o){title=o.title,project_name=o.project_name;var l={clientName:o.client_name,id:o.id,projectName:o.project_name,teamName:o.team_name,title:o.title,typeName:o.type_name,prog:o.time_progress,creator:o.user_name,responsible:o.responsible_name,createdAt:t(new Date(o.created_at)),startDate:t(new Date(o.start_date)),typeTask:o.type_name,stateTask:a(o.state),timeWorked:e(o.time_worked),timePending:e(o.time_pending),timeTotal:e(o.time_total),attachCount:o.attachments_count};o.title.length>25&&(title=o.title),o.project_name.length>25&&(project_name=o.project_name),o.is_working_on?s.append(`<li data-id-task="${o.id}" class="showTask">\r\n\t\t\t\t\t\t\t\t\t\t \t<i class="fa fa-pause pauseTask"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class="info">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript: void(0)" class="title truncate" title="${o.title}">${title}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript: void(0)" class="project truncate" title="${o.project_name}">${project_name}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="client">${o.client_name}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="https://secure.runrun.it/tasks/${o.id}" class="externalLink" target="_blank"><i class="fa fa-external-link"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t </li>`).children(`li[data-id-task=${o.id}]`).data("info",l):s.append(`<li data-id-task="${o.id}" class="showTask">\r\n\t\t\t\t\t\t\t\t\t\t \t<i class="fa fa-play playTask"></i>\r\n\t\t\t\t\t\t\t\t\t\t\t<div class="showTask info">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript: void(0)" class="title truncate" title="${o.title}">${title}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="javascript: void(0)" class="project truncate" title="${o.project_name}">${project_name}</a>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="client">${o.client_name}</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="https://secure.runrun.it/tasks/${o.id}" class="externalLink" target="_blank"><i class="fa fa-external-link"></i></a>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t </li>`).children(`li[data-id-task=${o.id}]`).data("info",l),console.log("List Tasks")})}}),$(document).on("click",".search-wrapper > i.fa-times",function(){$("input#search").val(""),$(".search-wrapper").find("i").removeClass("fa-times").addClass("fa-search"),$("#list-tasks li").show()}),$("input#search").on("keyup",function(e){var t=this;$(".search-wrapper").find("i").removeClass("fa-search").addClass("fa-times"),$("#list-tasks li").each(function(e,a){""!=$(t).val()?$(this).text().toLowerCase().indexOf($(t).val().toLowerCase())>-1?$(this).show():$(this).hide():$(this).show()})})}function i(e){$(".sectionTemplate").removeClass("active"),$(e).addClass("active"),1==config.auth?(menuApp.addClass("active"),l.responseCallback(s),l.getDados()):menuApp.removeClass("active")}function o(){var e=l.profile.id,t=l.profile.name,a=l.profile.avatar_large_url;$("#loadStat > .infos > .image").html('<img src="'+a+'">'),$("#loadStat > .infos > .name").html(t),$.ajax({type:"GET",url:urlAPI+urlUserStat+e,beforeSend:function(){},success:function(e){console.log("Load User Stat"),$(".value").html(e.total)},error:function(){console.log("Error Load User Stat")}})}var l=function(){function e(){$.ajax({type:"GET",url:urlAPI+urlUsers+window.localStorage.getItem("username"),beforeSend:function(){},success:function(e){a=e,"function"==typeof t&&t()},error:function(){config.auth=0,i("#loadLogin")}})}var t,a;return{responseCallback:function(e){t=e},getDados:function(){e()},get profile(){return a}}}();$(".open-options").on("click",function(){$(".menuOptions").toggleClass("active")}),$("body").on("click",function(e){var t=e.target;$(t).closest("a").hasClass("open-options")||$(t).closest("ul").hasClass("menuOptions")||$(".menuOptions").removeClass("active")}),null===username?(config.auth=0,i("#loadLogin")):(config.auth=1,i("#loadTasks")),$("#doLogin").on("click",function(){var e=$("#username"),t=$("#error");$.ajax({type:"GET",url:urlAPI+urlUsers+e.val(),beforeSend:function(){e.prop("disabled",!0),window.localStorage.setItem("username",e.val())},success:function(){e.prop("disabled",!0),config.auth=1,i("#loadTasks"),console.log("Logged")},error:function(){t.html("Login InvÃ¡lido!"),e.prop("disabled",!1),window.localStorage.removeItem("username"),i("#loadLogin"),console.log("Error Logged")}})}),$(document).on("click",".playTask",function(e){e.stopPropagation();var t=$(this),a=$(this).parent().data("id-task");$.ajax({type:"POST",url:urlAPI+urlTasks+"/"+a+"/play",beforeSend:function(){t.removeClass("fa-play playTask").addClass("fa-clock-o")},success:function(e){console.log("Task Play"),t.removeClass("fa-play playTask fa-clock-o").addClass("fa-pause pauseTask")},error:function(){console.log("Error Task Play")}})}),$(document).on("click",".pauseTask",function(e){e.stopPropagation();var t=$(this),a=$(this).parent().data("id-task");$.ajax({type:"POST",url:urlAPI+urlTasks+"/"+a+"/pause",beforeSend:function(){t.removeClass("fa-pause pauseTask").addClass("fa-clock-o")},success:function(e){console.log("Task Pause"),t.removeClass("fa-pause pauseTask fa-clock-o").addClass("fa-play playTask")},error:function(){console.log("Error Task Pause")}})}),$(document).on("click",".showSection",function(){var e=$(this).attr("id");$(".showSection").removeClass("active"),$(this).addClass("active"),$(".sectionTemplate").removeClass("active"),$(e).addClass("active"),"#loadStat"==e&&o()}),$(document).on("click",".showTask",function(e){e.stopPropagation(),$(".tabIntern").addClass("hide"),$(".description").removeClass("hide"),$("#list-tasks > li").removeClass("selected");var t=$(this).closest("li").data("id-task"),a=$(this).closest("li").data("info");$(this).closest("li").addClass("selected"),$(".alert button.deliver").data("info",a),$(".detail-task > .task-title").text(a.id+" - "+a.title),$(".detail-task > div.progress-bar").attr("title",Math.round(a.prog)+"%"),$(".detail-task > div.progress-bar > div.fill").css({width:(a.prog>=100?100:a.prog)+"%"}),$(".detail-task > div.progress-bar > div.fill").removeClass("ok"),$(".detail-task > div.progress-bar > div.fill").removeClass("past60"),$(".detail-task > div.progress-bar > div.fill").removeClass("late"),a.prog<60?$(".detail-task > div.progress-bar > div.fill").addClass("ok"):a.prog>=60&&a.prog<90?$(".detail-task > div.progress-bar > div.fill").addClass("past60"):$(".detail-task > div.progress-bar > div.fill").addClass("late"),$(".detail-task > .task-title").attr("title",a.id+" - "+a.title),$(".detail-task > .project-name").text(a.projectName),$(".detail-task > .project-name").attr("title",a.projectName),$(".detail-task > .client-name").text(a.clientName),$(".detail-task > .client-name").attr("title",a.clientName),$(".detail-task > .details > .creator > div").text(a.creator),$(".detail-task > .details > .responsible > div").text(a.responsible),$(".detail-task > .details > .created_at > div").text(a.createdAt),$(".detail-task > .details > .start_date > div").text(a.startDate),$(".detail-task > .details > .type > div").text(a.typeTask),$(".detail-task > .details > .state > div").text(a.stateTask),$(".detail-task > .details > .time_worked > div").text(a.timeWorked),$(".detail-task > .details > .time_pending > div").text(a.timePending),$(".detail-task > .details > .time_total > div").text(a.timeTotal),$(".detail-task > .details > .attach_count > div").text(a.attachCount),$.ajax({type:"GET",url:urlAPI+urlTasks+"/"+t+"/description",beforeSend:function(){},success:function(e){console.log("Load Description Task"),$("#tasks, .detail-task").addClass("active"),$(".detail-task > .description").html(e.description)},error:function(){console.log("Error Load Description Task")}}),$.ajax({type:"GET",url:urlAPI+urlTasks+"/"+t+"/documents",beforeSend:function(){$(".detail-task > .attachments > ul").html("")},success:function(e){console.log("Load Attachments Task"),$("#tasks, .detail-task").addClass("active"),$.each(e,function(e,t){$(".detail-task > .attachments > ul").append("<li>"+t.data_file_name+"</li>")})},error:function(){console.log("Error Load Attachments Task")}})}),$(document).on("click",".backTasks",function(){$("#tasks, .detail-task").removeClass("active")}),$(document).on("click",".showInternTask",function(){var e=$(this).attr("href");$(".tabIntern").addClass("hide"),$(e).removeClass("hide")}),$(document).on("click",".deliver",function(){$(".detail-task").hasClass("off-screen")||($(".detail-task").addClass("off-screen"),$(".alert").addClass("active")),$(".alert button.deliver").click(function(){var e=$(this).data("info"),t=urlAPI+urlTasks+"/"+e.id+"/close";$.ajax({type:"POST",url:t,beforeSend:function(){$("button.deliver").html('<i class="fa fa-circle-o-notch fa-spin"></i>').prop("disabled",!0)},success:function(e){$("#tasks").removeClass("active"),$(".detail-task").removeClass("active"),$(".alert").removeClass("active"),s()},error:function(){$("button.deliver").html('<i class="fa fa-paper-plane"></i> ENTREGAR').prop("disabled",!1)}})}),$(".alert button.cancel").click(function(){$(".detail-task").hasClass("off-screen")&&($(".detail-task").removeClass("off-screen"),$(".alert").removeClass("active"))})})});